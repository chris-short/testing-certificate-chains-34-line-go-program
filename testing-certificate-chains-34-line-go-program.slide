Golang to the rescue: Saving DevOps from TLS turmoil
GopherCon 2017 Lightning Talk

Chris Short
Manager of DevOps at Bankrate
chris@chrisshort.net
https://devopsish.com
@ChrisShort

* Introduction
Chris Short

- opensource.com and DZone Contributor
- Contributed to The Open Organization Guide to IT Culture Change
- DevOpsDays Speaker and Organizer
- devopsish.com
- chrisshort.net

* But Most Importantly
.image img/gopherize-me-chris-short.png _ 550
.caption Me in Gopher Form by [[https://gopherize.me/][Gopherize.me]]

* Not Too Long Ago in a Place of Work Far, Far Away...
.image img/backstory.png 575 _

* 
.image img/2-chainz-tell-em.png _ 550
.caption 2 Chainz

* This is the Goal
.image img/chrisshort_net-qualys.png 525 _
.caption Qualys SSL Labs Scan of [[https://chrisshort.net][chrisshort.net]]

* NBD ... OMG
.image img/ssl-vendors-suck.png 550 _

* 
.image img/jackie-chan.jpg 550 _
.caption Jackie Chan

* So What Does Any Good Engineer Do?
.image img/go_build.png _ 500
.caption Go Build by [[https://github.com/ashleymcnamara/gophers][Ashley McNamara]]

* Three Go Packages: log
- The go `log` package is pretty self explanatory
- Package that enables logging
- There should be a spectacular failure at the sign of trouble
- `log` has three helper functions: `print`, `fatal`, and `panic`
- Output from the package goes to `stderr`
- Used a `fatal` error to get the web server to stop and log any issue
.image img/hugging_gophers.png _ 225
.caption Hugging Gophers by [[https://github.com/ashleymcnamara/gophers][Ashley McNamara]]

* Three Go Packages: crypto/tls
- The Go `crypto/tls` package partially implements TLS 1.2, as specified in RFC 5246
- Package configures usable SSL/TLS versions
- Identifies preferred cipher suites and elliptic curves used during handshakes
- This is the package that handles connections securely
.image img/GOPHER_STAR_WARS.png _ 375
.caption Gopher Star Wars by [[https://github.com/ashleymcnamara/gophers][Ashley McNamara]]

* Three Go Packages: net/http
- Go implementation of HTTP
- `net/http` has a function called `ListenAndServeTLS`
- ListenAndServeTLS provides the desired certificate checking functionality
- "If the certificate is signed by a certificate authority, the certFile should be the concatenation of the server's certificate, any intermediates, and the CA's certificate."
.image img/GOPHER_INCLUSION.png _ 275
.caption Gopher Inclusion by [[https://github.com/ashleymcnamara/gophers][Ashley McNamara]]

* main: mux, cfg, srv
- Code creates a `mux`, short for HTTP request multiplexer
- `mux` has a function that creates an HTTP server with headers and content (Hello World!)
- `cfg` brings in all the TLS bits seen in a solid web server config
- `srv` puts the pieces together and defines what port to listen on
.image img/GOPHER_SHARE.png _ 450
.caption Gopher Share by [[https://github.com/ashleymcnamara/gophers][Ashley McNamara]]

* Fail Spectacularly
- I ❤️ DevOps. I embrace failure.
- `log.Fatal(srv.ListenAndServeTLS("/etc/ssl-tester/tls.crt",` `"/etc/ssl-tester/tls.key"))`
- Defines path of certificate files to use
- Also logs a fatal error if certificate is not valid
- Fails Fast
.image img/nuclear-weapons-test-explosion.jpg 300 _
